{% extends "admin/base_site.html" %}
{% load i18n static admin_urls %}

{% block extrastyle %}
<style>
    .upload-form {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    .form-group {
        margin-bottom: 1rem;
    }
    .form-control {
        display: block;
        width: 100%;
        padding: .375rem .75rem;
        font-size: 1rem;
        line-height: 1.5;
        border: 1px solid #ced4da;
        border-radius: .25rem;
    }
    .template-info {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 4px;
    }
    .template-table {
        width: 100%;
        margin-bottom: 1rem;
        background-color: transparent;
        border-collapse: collapse;
    }
    .template-table th, .template-table td {
        padding: .75rem;
        vertical-align: top;
        border-top: 1px solid #dee2e6;
    }
    .template-table thead th {
        vertical-align: bottom;
        border-bottom: 2px solid #dee2e6;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='users' %}">{% trans 'Users' %}</a>
    &rsaquo; {% trans 'Import Voters' %}
</div>
{% endblock %}

{% block content %}
<div class="upload-form">
    <h1>{% trans "Import Voters from CSV" %}</h1>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <p><strong>Instructions:</strong></p>
                        <ul>
                            <li>CSV file should contain columns: <code>voter_id</code>, <code>email</code>, <code>first_name</code>, <code>last_name</code>, <code>state</code>, <code>constituency</code> (required)</li>
                            <li>Optional columns: <code>password</code>, <code>date_of_birth</code>, <code>gender</code> (M/F/O), <code>mobile_number</code>, <code>address_line1</code>, <code>address_line2</code>, <code>city</code>, <code>pincode</code></li>
                            <li>State names must match existing states in the system</li>
                            <li>Constituency names must match existing constituencies in the selected state</li>
                            <li>Voter ID must follow format: <code>ABC1234567</code> (3 letters followed by 7 digits)</li>
                        </ul>
                    </div>

                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="form-group mb-3">
                            <label for="voters_csv">Choose CSV File:</label>
                            <input type="file" name="voters_csv" id="voters_csv" class="form-control" accept=".csv" required>
                        </div>
                        
                        <div class="form-group mb-3">
                            <button type="submit" class="btn btn-primary">Import Voters</button>
                            <a href="{% url 'admin:users_voter_changelist' %}" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                    
                    <div class="mt-4">
                        <h4>Sample CSV Format</h4>
                        <pre class="p-3 bg-light">voter_id,email,first_name,last_name,state,constituency,password,date_of_birth,gender,mobile_number,address_line1,city,pincode
ABC1234567,voter1@example.com,Rahul,Kumar,Karnataka,Bangalore Central,password123,1990-05-15,M,+911234567890,123 Main St,Bangalore,560001
DEF7654321,voter2@example.com,Priya,Sharma,Maharashtra,Mumbai South,secure456,1988-10-22,F,+919876543210,456 Park Ave,Mumbai,400001</pre>
                    </div>
                    
                    <div class="mt-4">
                        <h4>Available States and Constituencies</h4>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="list-group">
                                    {% for state in states %}
                                    <div class="list-group-item">
                                        <h5 class="mb-1">{{ state.name }}</h5>
                                        <p class="mb-1 text-muted">Code: {{ state.code }}</p>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="list-group">
                                    {% for constituency in constituencies %}
                                    <div class="list-group-item">
                                        <h5 class="mb-1">{{ constituency.name }}</h5>
                                        <p class="mb-1 text-muted">State: {{ constituency.state.name }} | Type: {{ constituency.get_constituency_type_display }}</p>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
